<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout – WEILGLASS</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

<header>
    <div class="header-inner">
        <div class="logo-wrap">
            <div class="logo-circle">
                <img src="images/logo.jpg" alt="Weilglass Logo">
            </div>
            <div class="site-title">
                <h1>WEILGLASS</h1>
                <span>HAND-BLOWN SKULLS • TOXIC LAB ENERGY</span>
            </div>
        </div>

        <nav>
            <a href="index.html">Home</a>
            <a href="gallery.html">Gallery</a>
            <a href="about.html">About</a>
            <a href="contact.html">Contact</a>
            <a href="store.html">Store</a>
            <a href="cart.html">Cart (0)</a>
        </nav>
    </div>
</header>


<div class="page">
    <h2 class="page-title">Checkout</h2>
    <p class="page-subtitle">Enter shipping details and complete payment</p>

    <!-- SHIPPING FORM -->
    <div class="card">
        <h3>Shipping Information</h3>
        <p>Please fill this out. PayPal unlocks once complete.</p>

        <form id="shippingForm" style="margin-top: 16px; display: grid; gap: 10px;">
            <input type="text" id="fullname" placeholder="Full Name" required>
            <input type="text" id="address" placeholder="Street Address" required>
            <input type="text" id="city" placeholder="City" required>
            <input type="text" id="state" placeholder="State" required>
            <input type="text" id="zip" placeholder="ZIP Code" required>
            <input type="email" id="email" placeholder="Email for Tracking" required>
        </form>
    </div>

    <br>

    <!-- PAYMENT OPTIONS -->
    <div class="card">
        <h3>Payment</h3>
        <p>Select your payment method:</p>

        <div class="pay-buttons" style="margin-top: 14px;">
            <a class="pay-btn pay-venmo" href="https://venmo.com/u/YOURNAME" target="_blank">
                Pay with Venmo
            </a>

            <a class="pay-btn pay-cashapp" href="https://cash.app/$YOURTAG" target="_blank">
                Pay with CashApp
            </a>
        </div>

        <br><br>

        <h3>PayPal Checkout</h3>
        <p>The total will appear here once the cart is built.</p>

        <div id="paypal-button-container"
             style="margin-top: 18px; opacity: 0.3; pointer-events: none;"></div>
    </div>
</div>


<footer>
    © 2025 WEILGLASS.
    <div class="skull-mark"></div>
</footer>

<!-- PAYPAL LIVE SDK (NO PAY LATER) -->
<script src="https://www.paypal.com/sdk/js?client-id=AZXr4BH7u_eLIFeQMYDeUiuKX5IZfyidUZGAWbvTLg9WD7oMtKpFGHyFpAkUg6Eu8qPIDK4JbnF4pnw8&currency=USD&disable-funding=paylater"></script>

<script>
// ===============================
//  GET CART TOTAL
// ===============================
let cartTotal = localStorage.getItem("cartTotal");

if (!cartTotal || Number(cartTotal) <= 0) {
    cartTotal = "0.00";
}

// Disable PayPal when cart is empty
if (cartTotal === "0.00") {
    document.getElementById("paypal-button-container").innerHTML =
        "<p style='color:#ff6060; font-weight:700;'>Your cart is empty. Add items before checking out.</p>";

    document.getElementById("paypal-button-container").style.opacity = "0.4";
    document.getElementById("paypal-button-container").style.pointerEvents = "none";
}

// ===============================
//  ENABLE PAYPAL WHEN FORM COMPLETE
// ===============================
const formInputs = document.querySelectorAll("#shippingForm input");
const paypalContainer = document.getElementById("paypal-button-container");

function validateForm() {
    let filled = Array.from(formInputs).every(i => i.value.trim() !== "");

    if (filled && cartTotal !== "0.00") {
        paypalContainer.style.opacity = "1";
        paypalContainer.style.pointerEvents = "all";
    }
}

formInputs.forEach(i => i.addEventListener("input", validateForm));


// ===============================
//  PAYPAL SMART BUTTONS (LIVE)
// ===============================
paypal.Buttons({
    style: {
        color: 'blue',
        shape: 'pill',
        label: 'pay',
        height: 40
    },

    // Create order with real amount
    createOrder: function(data, actions) {
        return actions.order.create({
            purchase_units: [{
                amount: { value: cartTotal },
                description: "WEILGLASS Custom Glass Art"
            }]
        });
    },

    // Payment approved
    onApprove: function(data, actions) {
        return actions.order.capture().then(function(details) {

            // Save shipping info
            const shippingData = {
                name: fullname.value,
                address: address.value,
                city: city.value,
                state: state.value,
                zip: zip.value,
                email: email.value,
                paypalName: details.payer.name.given_name
            };

            localStorage.setItem("shippingInfo", JSON.stringify(shippingData));

            // Redirect
            window.location.href = "thankyou.html";
        });
    }

}).render('#paypal-button-container');

</script>


</body>
</html>
